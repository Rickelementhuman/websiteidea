<!DOCTYPE html>
<html>
<head>
    <style>
        :root {
            --navy: #1e293b;
            --blue1: #2563eb;
            --white: #fff;
            --light-gray: #f8f9fa;
            --border-color: #e5e7eb;
            --shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        }

        .blog-listing-section {
            padding: 100px 0;
            background: linear-gradient(180deg, #fafbfc 0%, #ffffff 100%);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .section-header {
            text-align: center;
            margin-bottom: 60px;
        }

        .section-title {
            font-size: 3rem;
            font-weight: 800;
            color: var(--navy);
            margin-bottom: 20px;
        }

        .filter-container {
            background: var(--white);
            border-radius: 16px;
            padding: 32px;
            margin-bottom: 48px;
            box-shadow: var(--shadow);
        }

        .filter-select {
            width: 200px;
            padding: 12px 16px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 1rem;
            background: var(--white);
        }

        .results-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 32px;
        }

        .blog-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(380px, 1fr));
            gap: 32px;
        }

        .blog-post {
            background: var(--white);
            border-radius: 20px;
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: transform 0.3s ease;
        }

        .blog-post:hover {
            transform: translateY(-8px);
        }

        .blog-post-image {
            width: 100%;
            height: 240px;
            overflow: hidden;
            position: relative;
        }

        .blog-post-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .blog-post-category {
            position: absolute;
            top: 16px;
            left: 16px;
            background: var(--blue1);
            color: var(--white);
            padding: 8px 16px;
            border-radius: 25px;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
        }

        .blog-post-content {
            padding: 24px;
        }

        .blog-post-title {
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--navy);
            margin-bottom: 12px;
        }

        .blog-post-summary {
            font-size: 1rem;
            color: var(--navy);
            opacity: 0.8;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .blog-post-link {
            display: inline-flex;
            background: var(--blue1);
            color: var(--white);
            padding: 12px 20px;
            border-radius: 25px;
            text-decoration: none;
            font-weight: 600;
        }

        .status-info {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 24px;
            font-size: 0.9rem;
        }

        @media (max-width: 768px) {
            .blog-grid {
                grid-template-columns: 1fr;
            }
            .section-title {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="blog-listing-section">
        <div class="container">
            <div class="section-header">
                <h2 class="section-title">Latest Insights</h2>
            </div>

            <div class="filter-container">
                <select id="category-filter" class="filter-select">
                    <option value="">All Categories</option>
                </select>
            </div>

            <div class="results-info">
                <div id="results-count">Loading posts...</div>
            </div>

            <div id="status-info" class="status-info" style="display: none;"></div>

            <div class="blog-grid" id="blog-grid">
                <!-- Posts will be loaded here -->
            </div>
        </div>
    </div>

    <script>
        class SimpleBlogListing {
            constructor() {
                this.posts = [];
                this.filteredPosts = [];
                this.categories = new Set();
                this.currentFilter = '';
                this.init();
            }

            init() {
                console.log('ðŸš€ Loading blog posts...');
                this.loadPosts();
                this.setupEventListeners();
            }

            loadPosts() {
                // Try to get posts from Webflow CMS first
                const cmsItems = document.querySelectorAll('.w-dyn-item');
                console.log(`Found ${cmsItems.length} CMS items`);

                if (cmsItems.length > 0) {
                    this.extractFromCMS(cmsItems);
                } else {
                    console.log('No CMS items found, using sample data');
                    this.loadSampleData();
                }

                this.populateCategories();
                this.renderPosts();
                this.updateResultsCount();
            }

            extractFromCMS(items) {
                this.posts = Array.from(items).map((item, index) => {
                    // Get data from attributes or fallback to content
                    const title = item.getAttribute('data-title') || 
                                 item.querySelector('h1, h2, h3')?.textContent || 
                                 `Blog Post ${index + 1}`;
                    
                    const category = item.getAttribute('data-category') || 
                                    this.guessCategory(title);
                    
                    const summary = item.getAttribute('data-summary') || 
                                   'Discover insights and strategies for your business.';
                    
                    const image = item.querySelector('img')?.src || 
                                 'https://images.unsplash.com/photo-1551288049-bebda4e38f71?w=400&h=240&fit=crop';
                    
                    const slug = item.getAttribute('data-slug') || 
                                this.createSlug(title);

                    this.categories.add(category);
                    
                    return {
                        id: `post-${index}`,
                        title,
                        category,
                        summary,
                        image,
                        slug
                    };
                });

                this.showStatus(`âœ… Loaded ${this.posts.length} posts from CMS`);
            }

            loadSampleData() {
                this.posts = [
                    {
                        id: 'post-1',
                        title: "Norwich City's Mental Health Ad Analysis",
                        category: 'advertising',
                        summary: 'A powerful example of emotional storytelling in advertising without a big budget.',
                        image: 'https://images.unsplash.com/photo-1557804506-669a67965ba0?w=400&h=240&fit=crop',
                        slug: 'norwich-city-mental-health-ad'
                    },
                    {
                        id: 'post-2',
                        title: 'Global Action Plan Stop Following Me Campaign',
                        category: 'advertising',
                        summary: 'Analyzing the importance of quick emotional reactions for memory encoding.',
                        image: 'https://images.unsplash.com/photo-1557804506-669a67965ba0?w=400&h=240&fit=crop',
                        slug: 'global-action-plan-campaign'
                    },
                    {
                        id: 'post-3',
                        title: 'Consumer Behavior in Digital Marketing',
                        category: 'market research',
                        summary: 'Key insights from market research and consumer behavior studies.',
                        image: 'https://images.unsplash.com/photo-1551288049-bebda4e38f71?w=400&h=240&fit=crop',
                        slug: 'consumer-behavior-digital'
                    },
                    {
                        id: 'post-4',
                        title: 'The Rise of Influencer Marketing',
                        category: 'influencer marketing',
                        summary: 'Latest trends and strategies in influencer marketing and social media.',
                        image: 'https://images.unsplash.com/photo-1611224923853-80b023f02d71?w=400&h=240&fit=crop',
                        slug: 'rise-of-influencer-marketing'
                    },
                    {
                        id: 'post-5',
                        title: 'AI-Powered Marketing Analytics',
                        category: 'ai',
                        summary: 'How artificial intelligence is revolutionizing marketing analytics.',
                        image: 'https://images.unsplash.com/photo-1677442136019-21780ecad995?w=400&h=240&fit=crop',
                        slug: 'ai-powered-marketing'
                    },
                    {
                        id: 'post-6',
                        title: 'Creative Campaign Optimization',
                        category: 'advertising',
                        summary: 'Effective advertising strategies and campaign optimization techniques.',
                        image: 'https://images.unsplash.com/photo-1557804506-669a67965ba0?w=400&h=240&fit=crop',
                        slug: 'creative-campaign-optimization'
                    }
                ];

                this.posts.forEach(post => this.categories.add(post.category));
                this.showStatus('âš ï¸ Using sample data - Set up CMS connection for full posts');
            }

            guessCategory(title) {
                const titleLower = title.toLowerCase();
                if (titleLower.includes('ad') || titleLower.includes('campaign')) return 'advertising';
                if (titleLower.includes('influencer') || titleLower.includes('social')) return 'influencer marketing';
                if (titleLower.includes('research') || titleLower.includes('data')) return 'market research';
                if (titleLower.includes('ai') || titleLower.includes('artificial')) return 'ai';
                return 'insights';
            }

            createSlug(title) {
                return title.toLowerCase().replace(/[^a-z0-9\s-]/g, '').replace(/\s+/g, '-');
            }

            setupEventListeners() {
                document.getElementById('category-filter').addEventListener('change', (e) => {
                    this.currentFilter = e.target.value;
                    this.filterPosts();
                });
            }

            populateCategories() {
                const select = document.getElementById('category-filter');
                this.categories.forEach(category => {
                    const option = document.createElement('option');
                    option.value = category;
                    option.textContent = this.formatCategory(category);
                    select.appendChild(option);
                });
            }

            formatCategory(category) {
                return category.split(' ').map(word => 
                    word.charAt(0).toUpperCase() + word.slice(1)
                ).join(' ');
            }

            filterPosts() {
                if (!this.currentFilter) {
                    this.filteredPosts = [...this.posts];
                } else {
                    this.filteredPosts = this.posts.filter(post => 
                        post.category === this.currentFilter
                    );
                }
                this.renderPosts();
                this.updateResultsCount();
            }

            renderPosts() {
                const grid = document.getElementById('blog-grid');
                grid.innerHTML = this.filteredPosts.map(post => `
                    <article class="blog-post">
                        <div class="blog-post-image">
                            <img src="${post.image}" alt="${post.title}" loading="lazy">
                            <span class="blog-post-category">${this.formatCategory(post.category)}</span>
                        </div>
                        <div class="blog-post-content">
                            <h3 class="blog-post-title">${post.title}</h3>
                            <p class="blog-post-summary">${post.summary}</p>
                            <a href="/blog/${post.slug}" class="blog-post-link">Read More</a>
                        </div>
                    </article>
                `).join('');
            }

            updateResultsCount() {
                const count = this.filteredPosts.length;
                const total = this.posts.length;
                document.getElementById('results-count').textContent = 
                    this.currentFilter ? `Showing ${count} of ${total} posts` : `${total} posts`;
            }

            showStatus(message) {
                const statusEl = document.getElementById('status-info');
                statusEl.textContent = message;
                statusEl.style.display = 'block';
                console.log(message);
            }
        }

        // Initialize when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => new SimpleBlogListing());
        } else {
            new SimpleBlogListing();
        }
    </script>
</body>
</html>